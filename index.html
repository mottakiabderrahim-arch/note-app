<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù…ÙÙƒØ±ØªÙŠ</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
  font-family:Arial;
  margin:0;
  padding:15px;
  background:#f5f5f5;
  transition:0.3s;
}

.dark{
  background:#1e1e1e;
  color:white;
}

input,button,select{
  padding:8px;
  margin:5px 0;
}

.note{
  padding:10px;
  margin-top:10px;
  border-radius:8px;
}

.dark .note{
  background:#2c2c2c !important;
}

#noteText{
  min-height:120px;
  padding:10px;
  border:1px solid #ccc;
  border-radius:8px;
  outline:none;
  background:white;
}

.dark #noteText{
  background:#333;
  color:white;
}

#toolbar{
  display:none;
  margin-top:5px;
}
</style>
</head>

<body oncontextmenu="return false">

<h2>ğŸ“’ Ù…ÙÙƒØ±ØªÙŠ</h2>

<button onclick="toggleDark()">ğŸŒ™ ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ</button>

<input type="text" id="search" placeholder="Ø¨Ø­Ø«..." oninput="displayNotes()">

<br>

<select id="sortSelect" onchange="displayNotes()">
  <option value="new">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
  <option value="old">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
  <option value="az">Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</option>
</select>

<input type="color" id="noteColor" value="#ffffff">

<br>

<input type="text" id="noteTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©">

<button onclick="toggleToolbar()">ğŸ¨ ØªÙ†Ø³ÙŠÙ‚</button>

<div id="toolbar">
<button onclick="format('bold')"><b>B</b></button>
<button onclick="format('italic')"><i>I</i></button>
<button onclick="format('underline')"><u>U</u></button>

<button onclick="setColor('red')">ğŸ”´</button>
<button onclick="setColor('blue')">ğŸ”µ</button>
<button onclick="setColor('green')">ğŸŸ¢</button>
<button onclick="setColor('black')">âš«</button>

<button onclick="highlight('yellow')">ğŸŸ¡</button>

<button onclick="fontSize(3)">A-</button>
<button onclick="fontSize(5)">A+</button>

<button onclick="addLink()">ğŸ”—</button>
<button onclick="addImage()">ğŸ“·</button>

<button onclick="insertAdvancedTable()">ğŸ“Š Ø¬Ø¯ÙˆÙ„+</button>
<button onclick="clearFormat()">ğŸ§¹</button>
</div>

<div id="noteText" contenteditable="true"></div>

<br>

<input type="datetime-local" id="reminder">

<br>

<button id="saveBtn" onclick="addOrUpdateNote()">â• Ø¥Ø¶Ø§ÙØ©</button>
<button onclick="deleteAll()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
<button onclick="exportPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>

<div id="notes"></div>

<script>

let notes = JSON.parse(localStorage.getItem("notes")) || [];
let editId = null;

function toggleToolbar(){
  let bar=document.getElementById("toolbar");
  bar.style.display = bar.style.display==="none" ? "block" : "none";
}

function format(cmd){ document.execCommand(cmd,false,null); }
function setColor(color){ document.execCommand("foreColor",false,color); }
function highlight(color){ document.execCommand("hiliteColor",false,color); }
function fontSize(size){ document.execCommand("fontSize",false,size); }

function addLink(){
  let url=prompt("Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·:");
  if(url) document.execCommand("createLink",false,url);
}

function addImage(){
  let input=document.createElement("input");
  input.type="file";
  input.accept="image/*";
  input.onchange=function(){
    let file=this.files[0];
    let reader=new FileReader();
    reader.onload=function(e){
      document.execCommand("insertImage",false,e.target.result);
    };
    reader.readAsDataURL(file);
  };
  input.click();
}

function clearFormat(){
  document.execCommand("removeFormat",false,null);
}

document.getElementById("noteText").addEventListener("paste",function(e){
  e.preventDefault();
  let text=(e.clipboardData||window.clipboardData).getData("text");
  document.execCommand("insertText",false,text);
});

function addOrUpdateNote(){

  let title=document.getElementById("noteTitle").value;
  let text=document.getElementById("noteText").innerHTML;
  let reminder=document.getElementById("reminder").value;
  let color=document.getElementById("noteColor").value;

  if(!title && !text) return;

  if(editId===null){
    notes.push({
      id:Date.now(),
      title:title,
      text:text,
      date:new Date().toLocaleString(),
      reminder: reminder ? new Date(reminder).getTime() : null,
      notified:false,
      color:color,
      pinned:false
    });
  }else{
    let note=notes.find(n=>n.id===editId);
    note.title=title;
    note.text=text;
    note.reminder= reminder ? new Date(reminder).getTime() : null;
    note.color=color;
    editId=null;
    document.getElementById("saveBtn").innerText="â• Ø¥Ø¶Ø§ÙØ©";
  }

  localStorage.setItem("notes",JSON.stringify(notes));

  document.getElementById("noteTitle").value="";
  document.getElementById("noteText").innerHTML="";
  document.getElementById("reminder").value="";

  displayNotes();
}

function displayNotes(){

  let search=document.getElementById("search").value.toLowerCase();
  let sort=document.getElementById("sortSelect").value;
  let container=document.getElementById("notes");
  container.innerHTML="";

  let sorted=[...notes];

  if(sort==="new"){ sorted.sort((a,b)=>b.id-a.id); }
  else if(sort==="old"){ sorted.sort((a,b)=>a.id-b.id); }
  else if(sort==="az"){ sorted.sort((a,b)=>a.title.localeCompare(b.title)); }

  sorted.sort((a,b)=>b.pinned-a.pinned);

  sorted.forEach(note=>{
    if(note.title.toLowerCase().includes(search) ||
       note.text.toLowerCase().includes(search)){

      container.innerHTML+=`
        <div class="note" style="background:${note.color || '#fff'}">
          <h3>${note.title}</h3>
          <div>${note.text}</div>
          <small>${note.date}</small><br>

          <button onclick="togglePin(${note.id})">
            ${note.pinned ? "ğŸ“Œ Ù…Ø«Ø¨Øª" : "ğŸ“ ØªØ«Ø¨ÙŠØª"}
          </button>

          <button onclick="editNote(${note.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button onclick="deleteNote(${note.id})">âŒ Ø­Ø°Ù</button>
        </div>
      `;
    }
  });
}

function togglePin(id){
  let note=notes.find(n=>n.id===id);
  note.pinned=!note.pinned;
  localStorage.setItem("notes",JSON.stringify(notes));
  displayNotes();
}

function editNote(id){
  let note=notes.find(n=>n.id===id);
  document.getElementById("noteTitle").value=note.title;
  document.getElementById("noteText").innerHTML=note.text;
  document.getElementById("noteColor").value=note.color || "#ffffff";

  if(note.reminder){
    let d=new Date(note.reminder);
    document.getElementById("reminder").value=d.toISOString().slice(0,16);
  }

  editId=id;
  document.getElementById("saveBtn").innerText="ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
  window.scrollTo({top:0,behavior:'smooth'});
}

function deleteNote(id){
  notes=notes.filter(n=>n.id!==id);
  localStorage.setItem("notes",JSON.stringify(notes));
  displayNotes();
}

function deleteAll(){
  if(confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙ„ØŸ")){
    notes=[];
    localStorage.removeItem("notes");
    displayNotes();
  }
}

function toggleDark(){
  document.body.classList.toggle("dark");
}

if("Notification" in window){
  Notification.requestPermission();
}

function checkReminders(){
  let now=Date.now();
  notes.forEach(note=>{
    if(note.reminder && !note.notified){
      if(now>=note.reminder){
        new Notification("ğŸ”” ØªØ°ÙƒÙŠØ±",{body:note.title});
        note.notified=true;
        localStorage.setItem("notes",JSON.stringify(notes));
      }
    }
  });
}
setInterval(checkReminders,30000);

/* Ø¬Ø¯ÙˆÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ */

function insertAdvancedTable(){
  let rows=parseInt(prompt("Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙØŸ",2));
  let cols=parseInt(prompt("Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©ØŸ",2));
  if(!rows||!cols) return;

  let id="table_"+Date.now();

  let table=`<div style="overflow:auto;margin-top:5px;">
  <table id="${id}" border="1"
  style="border-collapse:collapse;width:100%;text-align:center;">`;

  for(let i=0;i<rows;i++){
    table+="<tr>";
    for(let j=0;j<cols;j++){
      table+=`<td contenteditable="true" style="padding:6px;">Ø®Ø§Ù†Ø©</td>`;
    }
    table+="</tr>";
  }

  table+=`</table>
  <div style="margin-top:5px;">
  <button onclick="addRow('${id}')">â• ØµÙ</button>
  <button onclick="deleteRow('${id}')">â– ØµÙ</button>
  <button onclick="addCol('${id}')">â• Ø¹Ù…ÙˆØ¯</button>
  <button onclick="deleteCol('${id}')">â– Ø¹Ù…ÙˆØ¯</button>
  </div></div><br>`;

  document.execCommand("insertHTML",false,table);
}

function addRow(id){
  let table=document.getElementById(id);
  let cols=table.rows[0].cells.length;
  let row=table.insertRow();
  for(let i=0;i<cols;i++){
    let cell=row.insertCell();
    cell.contentEditable="true";
    cell.innerHTML="Ø®Ø§Ù†Ø©";
    cell.style.padding="6px";
  }
}

function deleteRow(id){
  let table=document.getElementById(id);
  if(table.rows.length>1){
    table.deleteRow(table.rows.length-1);
  }
}

function addCol(id){
  let table=document.getElementById(id);
  for(let i=0;i<table.rows.length;i++){
    let cell=table.rows[i].insertCell();
    cell.contentEditable="true";
    cell.innerHTML="Ø®Ø§Ù†Ø©";
    cell.style.padding="6px";
  }
}

function deleteCol(id){
  let table=document.getElementById(id);
  let cols=table.rows[0].cells.length;
  if(cols>1){
    for(let i=0;i<table.rows.length;i++){
      table.rows[i].deleteCell(cols-1);
    }
  }
}

/* PDF */

function exportPDF(){
  let element=document.getElementById("noteText");
  if(!element.innerHTML.trim()){
    alert("Ù…Ø§ ÙƒØ§ÙŠÙ†Ø§Ø´ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ø§Ø´ ØªØªØµØ¯Ø±");
    return;
  }

  let opt={
    margin:10,
    filename:'mofakirti.pdf',
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  };

  html2pdf().set(opt).from(element).save();
}

displayNotes();

</script>

</body>
</html>
