<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…ÙÙƒØ±ØªÙŠ</title>

<style>
body{
    margin:0;
    padding:0;
    font-family:sans-serif;
    background:#f5f5f5;
}

.container{
    max-width:600px;
    margin:auto;
    padding:8px;
}

/* Ø§Ù„ØµÙØ­Ø§Øª */
#home,#editor{padding:5px;}
#editor{display:none;}

/* Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
.note{
    background:white;
    padding:8px;
    margin-bottom:8px;
    border-radius:6px;
    cursor:pointer;
}
.note small{color:gray}

/* inputs */
input,button{
    padding:8px;
    font-size:15px;
    width:100%;
    margin-bottom:8px;
}

/* Ù†Øµ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© */
#text{
    min-height:35vh;
    max-height:45vh;
    overflow-y:auto;
    border:1px solid #ddd;
    border-radius:6px;
    padding:10px;
    background:white;
    outline:none;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
#actions{
    display:flex;
    gap:8px;
}
#actions button{flex:1}

/* Ø²Ø± + */
#add{
    position:fixed;
    bottom:15px;
    right:15px;
    width:48px;
    height:48px;
    border-radius:50%;
    font-size:26px;
    background:#e53935;
    color:white;
    border:none;
}

/* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ„ÙˆÙŠÙ† */
#tools{
    display:flex;
    justify-content:center;
    gap:12px;
    margin-top:8px;
}
.color{
    width:22px;
    height:22px;
    border-radius:50%;
    cursor:pointer;
    border:2px solid #ccc;
}
.color.active{border:3px solid #000}

/* 3 Ù†Ù‚Ø§Ø· */
#menuBtn{
    position:fixed;
    top:10px;
    right:10px;
    font-size:22px;
    cursor:pointer;
}
#menu{
    position:fixed;
    top:40px;
    right:10px;
    background:white;
    border-radius:6px;
    box-shadow:0 2px 6px rgba(0,0,0,.2);
    display:none;
}
#menu div{
    padding:10px;
    cursor:pointer;
}

/* Ø±Ù…Ø² Ø§Ù„Ø­Ù…Ø§ÙŠØ© */
#lockBox{display:none;}
</style>
</head>

<body>

<div id="menuBtn" onclick="toggleMenu()">â‹®</div>
<div id="menu">
    <div onclick="toggleLock()">ğŸ” Ø±Ù…Ø² Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
</div>

<div class="container">

<div id="lockBox">
    <input id="pin" type="password" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²">
    <button onclick="savePin()">Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø²</button>
</div>

<div id="home">
    <input id="search" placeholder="Ø¨Ø­Ø«...">
    <div id="notesList"></div>
</div>

<div id="editor">
    <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©">
    <div id="text" contenteditable="true"></div>

    <div id="actions">
        <button onclick="saveNote()">Ø­ÙØ¸</button>
        <button onclick="deleteNote()">Ø­Ø°Ù</button>
        <button onclick="back()">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="tools">
        <div class="color" data-color="black" style="background:black"></div>
        <div class="color" data-color="red" style="background:red"></div>
        <div class="color" data-color="blue" style="background:blue"></div>
        <div class="color" data-color="green" style="background:green"></div>
    </div>
</div>

</div>

<button id="add" onclick="newNote()">+</button>

<script>
let notes = JSON.parse(localStorage.getItem("notes") || "[]");
let current = null;
let currentColor = localStorage.getItem("lastColor") || "black";
let savedRange = null;

const home = document.getElementById("home");
const editor = document.getElementById("editor");
const list = document.getElementById("notesList");
const text = document.getElementById("text");
const title = document.getElementById("title");
const search = document.getElementById("search");
const colors = document.querySelectorAll(".color");

/* Ø­ÙØ¸ Ø§Ù„Ù…Ø¤Ø´Ø± */
function saveSelection(){
    let sel = window.getSelection();
    if(sel.rangeCount > 0){
        savedRange = sel.getRangeAt(0);
    }
}
text.addEventListener("keyup", saveSelection);
text.addEventListener("mouseup", saveSelection);

/* Ø§Ù„ØªÙ„ÙˆÙŠÙ† */
function activateColor(color){
    currentColor = color;
    localStorage.setItem("lastColor", color);

    colors.forEach(c=>c.classList.remove("active"));
    document.querySelector(`[data-color="${color}"]`).classList.add("active");

    text.focus();
    if(savedRange){
        let sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(savedRange);
    }
    document.execCommand("styleWithCSS", false, true);
    document.execCommand("foreColor", false, color);
}
colors.forEach(c=>{
    c.onclick = ()=>activateColor(c.dataset.color);
});

/* Ø§Ù„ØªØ®Ø²ÙŠÙ† */
function saveStorage(){
    localStorage.setItem("notes", JSON.stringify(notes));
}

function render(){
    list.innerHTML="";
    notes.forEach((n,i)=>{
        if(n.title.includes(search.value) || n.content.includes(search.value)){
            let d=document.createElement("div");
            d.className="note";
            d.innerHTML=`<strong>${n.title}</strong><br><small>${n.date}</small>`;
            d.onclick=()=>editNote(i);
            list.appendChild(d);
        }
    });
}
search.oninput = render;

function newNote(){
    current=null;
    title.value="";
    text.innerHTML="";
    activateColor(currentColor);
    home.style.display="none";
    editor.style.display="block";
}

function editNote(i){
    current=i;
    title.value=notes[i].title;
    text.innerHTML=notes[i].content;
    activateColor(currentColor);
    home.style.display="none";
    editor.style.display="block";
}

function saveNote(){
    if(!title.value && !text.innerHTML) return;
    let note={
        title:title.value||"Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",
        content:text.innerHTML,
        date:new Date().toLocaleString()
    };
    current===null ? notes.push(note) : notes[current]=note;
    saveStorage();
    back();
}

function deleteNote(){
    if(current===null) return;
    if(confirm("Ù…ØªØ£ÙƒØ¯ ØªØ­Ø°ÙØŸ")){
        notes.splice(current,1);
        saveStorage();
        back();
    }
}

function back(){
    editor.style.display="none";
    home.style.display="block";
    render();
}

/* 3 Ù†Ù‚Ø§Ø· */
function toggleMenu(){
    let m=document.getElementById("menu");
    m.style.display = m.style.display==="block"?"none":"block";
}

/* Ø±Ù…Ø² Ø§Ù„Ø­Ù…Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
function toggleLock(){
    let l=document.getElementById("lockBox");
    l.style.display = l.style.display==="block"?"none":"block";
}
function savePin(){
    let p=document.getElementById("pin").value;
    if(p){
        localStorage.setItem("pin",p);
        alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ù…Ø²");
    }
}

/* ØªØ´ØºÙŠÙ„ */
activateColor(currentColor);
render();
</script>

</body>
</html>
