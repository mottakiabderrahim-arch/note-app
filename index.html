<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø°ÙƒØ±ØªÙŠ</title>

<style>
:root{
  --bg:#f2f2f2;
  --card:#fff;
  --text:#000;
  --main:#2196f3;
  --noteSize:16px;
}

body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#fff;
}

body{
  margin:0;
  font-family:sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--main);
  color:#fff;
  padding:12px;
  text-align:center;
  font-size:18px;
  position:relative;
}

.menu-btn{
  position:absolute;
  left:10px;
  top:8px;
  font-size:22px;
  cursor:pointer;
}

.menu{
  display:none;
  position:absolute;
  left:10px;
  top:45px;
  background:var(--card);
  box-shadow:0 2px 6px rgba(0,0,0,.3);
  border-radius:6px;
  overflow:hidden;
  z-index:10;
}

.menu div{
  padding:10px;
  cursor:pointer;
  border-bottom:1px solid #ccc;
}

.menu div:last-child{border:none}

#container{padding:10px}

input{
  width:100%;
  padding:10px;
  font-size:16px;
  border-radius:6px;
  border:1px solid #ccc;
  margin-top:8px;
}

#editor{
  margin-top:8px;
  padding:10px;
  min-height:120px;
  border-radius:6px;
  border:1px solid #ccc;
  background:#fff;
  outline:none;
}

.toolbar button{
  padding:6px 10px;
  margin:4px 2px;
  font-size:14px;
}

#tools{
  display:flex;
  gap:10px;
  margin:6px 0;
}

.color{
  width:26px;
  height:26px;
  border-radius:50%;
  cursor:pointer;
  border:2px solid #ccc;
}

.color.active{
  border:3px solid #000;
}

button.save{
  margin-top:8px;
  padding:10px;
  width:100%;
  font-size:16px;
  border:none;
  border-radius:6px;
  background:#4caf50;
  color:#fff;
}

.note{
  background:var(--card);
  margin-top:10px;
  padding:10px;
  border-radius:6px;
  position:relative;
  font-size:var(--noteSize);
}

.note-title{
  font-weight:bold;
  font-size:18px;
  margin-bottom:6px;
}

.delete{
  position:absolute;
  left:10px;
  top:10px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <span class="menu-btn" onclick="toggleMenu()">â‹®</span>
  ğŸ“’ Ù…Ø°ÙƒØ±ØªÙŠ
  <div class="menu" id="menu">
    <div onclick="toggleDark()">ğŸŒ™ ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ</div>
    <div onclick="setPin()">ğŸ”’ Ø±Ù…Ø² Ø§Ù„Ù‚ÙÙ„</div>
    <div onclick="changeFont(1)">ğŸ”  ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø·</div>
    <div onclick="changeFont(-1)">ğŸ”¡ ØªØµØºÙŠØ± Ø§Ù„Ø®Ø·</div>
    <div onclick="toggleOrder()">â†•ï¸ ØªØ±ØªÙŠØ¨</div>
    <div onclick="deleteAll()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</div>
  </div>
</header>

<div id="container">
  <input id="search" placeholder="ğŸ” Ø¨Ø­Ø«..." oninput="showNotes()">
  <input id="title" placeholder="ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©">

  <div class="toolbar">
    <button onclick="cmd('bold')"><b>B</b></button>
    <button onclick="cmd('italic')"><i>I</i></button>
    <button onclick="cmd('underline')"><u>U</u></button>
  </div>

  <div id="tools">
    <div class="color" data-color="black" style="background:black"></div>
    <div class="color" data-color="red" style="background:red"></div>
    <div class="color" data-color="blue" style="background:blue"></div>
    <div class="color" data-color="green" style="background:green"></div>
  </div>

  <div id="editor" contenteditable="true">Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§...</div>

  <button class="save" onclick="saveNote()">ğŸ’¾ Ø­ÙØ¸</button>

  <div id="notes"></div>
</div>

<script>
/* ===== Ø¹Ù†Ø§ØµØ± DOM (Ø£ÙˆÙ„Ø§Ù‹) ===== */
const editor = document.getElementById("editor");
const title = document.getElementById("title");
const notesBox = document.getElementById("notes");
const search = document.getElementById("search");
const menu = document.getElementById("menu");
const colors = document.querySelectorAll(".color");

/* ===== Ù…ØªØºÙŠØ±Ø§Øª ===== */
let notes = JSON.parse(localStorage.getItem("notes") || "[]");
let editIndex = -1;
let orderNewFirst = true;
let fontSize = parseInt(localStorage.getItem("fontSize")||16);
let currentColor = localStorage.getItem("lastColor") || "black";
let savedRange = null;

document.documentElement.style.setProperty("--noteSize",fontSize+"px");

/* ===== Ø§Ù„Ù‚ÙÙ„ ===== */
let pin = localStorage.getItem("pin");
if(pin){
  let p = prompt("ğŸ”’ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²");
  if(p !== pin) document.body.innerHTML="âŒ Ø±Ù…Ø² Ø®Ø§Ø·Ø¦";
}

/* ===== ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ===== */
function toggleMenu(){
  menu.style.display = menu.style.display==="block"?"none":"block";
}

function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true"){
  document.body.classList.add("dark");
}

function setPin(){
  let p = prompt("Ø¶Ø¹ Ø±Ù…Ø² Ø§Ù„Ù‚ÙÙ„");
  if(p){ localStorage.setItem("pin",p); alert("ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ ğŸ”’"); }
}

function changeFont(v){
  fontSize+=v;
  if(fontSize<12) fontSize=12;
  localStorage.setItem("fontSize",fontSize);
  document.documentElement.style.setProperty("--noteSize",fontSize+"px");
}

function toggleOrder(){
  orderNewFirst=!orderNewFirst;
  showNotes();
}

function deleteAll(){
  if(confirm("Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŸ")){
    notes=[];
    localStorage.setItem("notes","[]");
    showNotes();
  }
}

function cmd(c){
  document.execCommand(c,false,null);
}

/* ===== Ø§Ù„ØªÙ„ÙˆÙŠÙ† (Ù…Ø³ØªÙ‚Ø± 100%) ===== */
function saveSelection(){
  let sel = window.getSelection();
  if(sel && sel.rangeCount>0){
    savedRange = sel.getRangeAt(0);
  }
}
editor.addEventListener("keyup", saveSelection);
editor.addEventListener("mouseup", saveSelection);

function activateColor(color){
  currentColor = color;
  localStorage.setItem("lastColor",color);

  colors.forEach(c=>c.classList.remove("active"));
  document.querySelector(`[data-color="${color}"]`).classList.add("active");

  editor.focus();
  if(savedRange){
    let sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(savedRange);
  }
  document.execCommand("styleWithCSS",false,true);
  document.execCommand("foreColor",false,color);
}

colors.forEach(c=>{
  c.onclick=()=>activateColor(c.dataset.color);
});
activateColor(currentColor);

/* ===== Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ===== */
function saveNote(){
  let ti=title.value.trim();
  let html=editor.innerHTML.trim();
  if(!ti && !html) return;

  let note={title:ti||"Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",html};
  editIndex==-1 ? notes.push(note) : notes[editIndex]=note;
  editIndex=-1;

  localStorage.setItem("notes",JSON.stringify(notes));
  title.value="";
  editor.innerHTML="";
  showNotes();
}

function showNotes(){
  notesBox.innerHTML="";
  let q=search.value.toLowerCase();
  let arr=[...notes];
  if(orderNewFirst) arr.reverse();

  arr.forEach((n,i)=>{
    if(!(n.title+n.html).toLowerCase().includes(q)) return;
    let d=document.createElement("div");
    d.className="note";
    d.innerHTML=`
      <span class="delete" onclick="del(${i})">ğŸ—‘ï¸</span>
      <div class="note-title">${n.title}</div>
      <div>${n.html}</div>
    `;
    d.onclick=()=>{
      title.value=n.title;
      editor.innerHTML=n.html;
      editIndex=i;
      window.scrollTo(0,0);
    };
    notesBox.appendChild(d);
  });
}

function del(i){
  if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ")){
    notes.splice(i,1);
    localStorage.setItem("notes",JSON.stringify(notes));
    showNotes();
  }
}

showNotes();
</script>

</body>
</html>
