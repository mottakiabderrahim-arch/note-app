<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…ÙÙƒØ±ØªÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>

<style>
:root{
  --bg:#f2f2f2;
  --card:#ffffff;
  --text:#000;
  --main:#4CAF50;
}

body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#fff;
}

body{
  margin:0;
  font-family:sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:var(--main);
  color:#fff;
  padding:10px;
  display:flex;
  gap:5px;
}

button{
  cursor:pointer;
}

#search{
  width:100%;
  padding:8px;
}

#notes{
  padding:10px;
}

.note{
  background:var(--card);
  margin-bottom:10px;
  padding:10px;
  border-radius:8px;
}

.note-title{
  font-weight:bold;
}

textarea{
  width:100%;
  min-height:120px;
  font-size:16px;
}

.hidden{display:none;}

.toolbar button{
  margin:2px;
}
</style>
</head>

<body>

<header>
  <button onclick="toggleDark()">ğŸŒ™</button>
  <button onclick="newNote()">â•</button>
  <button onclick="sortNotes()">â†•ï¸</button>
  <input id="search" placeholder="ğŸ” Ø¨Ø­Ø«..." oninput="renderNotes()">
</header>

<div id="notes"></div>

<script>
let notes = JSON.parse(localStorage.getItem("notes")||"[]");
let sortMode = "date";

function save(){
  localStorage.setItem("notes", JSON.stringify(notes));
}

function newNote(){
  notes.unshift({
    id:Date.now(),
    title:"Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©",
    text:"",
    created:new Date().toLocaleString(),
    updated:new Date().toLocaleString(),
    locked:false,
    pass:"",
    image:""
  });
  save();
  renderNotes();
}

function toggleDark(){
  document.body.classList.toggle("dark");
}

function sortNotes(){
  sortMode = sortMode==="date"?"title":"date";
  renderNotes();
}

function renderNotes(){
  let q = document.getElementById("search").value.toLowerCase();
  let list = [...notes];

  if(sortMode==="title"){
    list.sort((a,b)=>a.title.localeCompare(b.title));
  }

  let html="";
  list.forEach(n=>{
    if(!n.title.toLowerCase().includes(q) && !n.text.toLowerCase().includes(q)) return;

    html+=`
    <div class="note">
      <input class="note-title" value="${n.title}"
        oninput="update(${n.id},'title',this.value)">
      
      <div class="toolbar">
        <button onclick="font(${n.id},1)">A+</button>
        <button onclick="font(${n.id},-1)">A-</button>
        <button onclick="lock(${n.id})">ğŸ”</button>
        <button onclick="img(${n.id})">ğŸ–¼ï¸</button>
        <button onclick="del(${n.id})">ğŸ—‘ï¸</button>
      </div>

      <textarea id="t${n.id}"
        oninput="update(${n.id},'text',this.value)"
        ${n.locked?'disabled':''}
      >${n.text}</textarea>

      ${n.image?`<img src="${n.image}" style="max-width:100%">`:""}

      <small>ğŸ“… ${n.created} | âœï¸ ${n.updated}</small>
    </div>
    `;
  });

  document.getElementById("notes").innerHTML = html;
}

function update(id,key,val){
  let n = notes.find(x=>x.id===id);
  n[key]=val;
  n.updated=new Date().toLocaleString();
  save();
}

function del(id){
  if(confirm("Ø­Ø°ÙØŸ")){
    notes = notes.filter(n=>n.id!==id);
    save();
    renderNotes();
  }
}

function font(id,d){
  let t=document.getElementById("t"+id);
  let s=parseInt(window.getComputedStyle(t).fontSize);
  t.style.fontSize=(s+d)+"px";
}

function lock(id){
  let n=notes.find(x=>x.id===id);
  if(!n.locked){
    let p=prompt("Ø±Ù…Ø² Ø§Ù„Ù‚ÙÙ„:");
    if(p){
      n.locked=true;
      n.pass=p;
    }
  }else{
    let p=prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²:");
    if(p===n.pass){
      n.locked=false;
    }
  }
  save();
  renderNotes();
}

function img(id){
  let i=document.createElement("input");
  i.type="file";
  i.accept="image/*";
  i.onchange=e=>{
    let r=new FileReader();
    r.onload=()=>{
      let n=notes.find(x=>x.id===id);
      n.image=r.result;
      save();
      renderNotes();
    };
    r.readAsDataURL(e.target.files[0]);
  };
  i.click();
}

renderNotes();
</script>

</body>
</html>
